<!DOCTYPE html>
<html>
<head>
	<title>Dialog</title>
	<script type="text/javascript">
		/*jslint esversion:6*/
		window.addEventListener('load', () => {
			window.el = {};
			window.el.reply = document.getElementById('reply');
			window.el.output = document.getElementById('output');
		});

		function reply ()
		{
			let text = window.el.reply.value;
			let scopes = Parser.createScopes(text);
			Domains.defineEntities(Domains.all.Basic, scopes);
			window.el.output.innerHTML = printArray(scopes);
			console.log('parsed:', scopes);
		}

		function printArray (arr, lvl = 1)
		{
			let tabs = new Array(lvl).join('\t');
			let answer = tabs + '[\n';
			for (let i = 0; i < arr.length; i++)
			{
				if (Array.isArray(arr[i]))
				{
					answer += printArray(arr[i], lvl + 1);
				}
				else if (typeof arr[i] === 'object')
				{
					answer += printObject(arr[i], lvl + 1);
				}
				else
				{
					answer += tabs + '\t"' + arr[i] + '"';
				}
				if (i !== arr.length - 1)
					answer += ',';
				answer += '\n';
			}
			return answer + tabs + ']';
		}

		function printObject (obj, lvl)
		{
			let tabs = new Array(lvl).join('\t');
			let answer = tabs + '{' + obj +  '\n';
			let keys = Object.keys(obj);
			for (let i = 0; i < keys.length; i++)
			{
				let prop = obj[keys[i]];
				if (Array.isArray(prop))
				{
					answer += tabs + '\t' + keys[i] + ':\n';
					answer += printArray(prop, lvl + 1);
				}
				else if (typeof prop === 'object')
				{
					answer += tabs + '\t' + keys[i] + ':\n';
					answer += printObject(prop, lvl + 1);
				}
				else
				{
					answer += tabs + '\t' + keys[i] + ': "' + prop + '"';
				}
				if (i !== keys.length - 1)
					answer += ',';
				answer += '\n';
			}
			return answer + tabs + '}';
		}
	</script>
	<script src="js/parser.js"></script>
	<script src="js/lexic.js"></script>

	<script src="js/domains.js"></script>
	<script src="js/domains/basic.js"></script>

	<script src="js/models.js"></script>

	<script src="js/understand.js"></script>

	<link rel="stylesheet" href="assets/style.css">
	<style>
		html, body {
			width: 100%; height: 100%;
			padding: 0; margin: 0;
			box-sizing: border-box;
			background: #333;
			color: #ddd;
		}
		body { padding: 5px; }
		#reply {
			width: 400px;
		}
		#output {
			padding: 5px;
			border: 1px solid #eee;
			font-size: 1.2em;
			box-sizing: border-box;
			width: 100%;
			min-height: 300px;
			overflow: auto;
		}
	</style>
</head>
<body>
	<input type="text" value="Finished #1, #2 was not reproduced." id="reply">
	<button type="button" onclick="reply();">Say</button>
	<div class="output">
		<div class="object">
			<div class="name">(root) <i>[object Object]</i></div>
			<div class="content">
				<div class="prop object">
					<div class="name">propObj <i>[object Huyobject]</i></div>
					<div class="content">
						<div class="prop object">
							<div class="name">inner <i>[object Object]</i></div>
							<div class="content">
								<div class="prop primitive">
									<span class="name">n</span>
									<span class="content number">3</span>
								</div>
								<div class="prop primitive">
									<span class="name">m</span>
									<span class="content number">3</span>
								</div>
								<div class="prop primitive">
									<span class="name">k</span>
									<span class="content number">0</span>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="prop primitive">
									<span class="name">n</span>
									<span class="content number">3</span>
				</div>
				<div class="prop object">
					<div class="name">propArray <i>[Array:3]</i></div>
					<div class="content">
						<div class="item" data-n="0">1</div>
						<div class="item" data-n="1">2</div>
						<div class="item" data-n="2">5</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<pre id="output">
entity typedef:
{
	type: string, // 'unknown' | 'modal' | 'modifier' | 'verb' | 'noun' | custom...
	source: string, // source token
	root: string, // lexical root
	lexic: { // lexical definition
		root: string, // the same
		suffixes: string[],
		prefixes: string[],
		probableParts: string[], // ['noun' | 'verb' | ...]
		time: number // as Lexic.Times
	},
}
	</pre>
</body>
</html>